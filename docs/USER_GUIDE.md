# 📖 用户指南

欢迎使用 Gallery Generate Agent！本指南将帮助您快速上手并充分利用所有功能。

## 目录

- [快速开始](#快速开始)
- [界面介绍](#界面介绍)
- [功能详解](#功能详解)
- [输出格式](#输出格式)
- [高级用法](#高级用法)
- [最佳实践](#最佳实践)

---

## 快速开始

### 第一次使用

1. **启动程序**
   ```bash
   python main.py
   ```

2. **选择图片文件夹**
   - 点击"浏览..."按钮
   - 选择包含图片的文件夹
   - 支持嵌套文件夹，程序会自动扫描所有子文件夹

3. **配置参数**（可选）
   - 聚类数量：设置为 5-10 通常效果较好
   - 输出格式：至少选择一种

4. **开始处理**
   - 点击"开始处理"按钮
   - 等待处理完成（首次运行需要下载模型）

5. **查看结果**
   - 处理完成后，点击"打开输出文件夹"
   - 查看生成的作品集

---

## 界面介绍

### 主窗口布局

```
┌─────────────────────────────────────┐
│        Gallery Generate Agent       │
├─────────────────────────────────────┤
│ 选择图片文件夹                       │
│ [文件夹路径显示框] [浏览...]         │
├─────────────────────────────────────┤
│ 处理参数                             │
│ 聚类数量: [5 ▼]                     │
│ 输出格式:                            │
│   ☑ HTML网页                        │
│   ☑ PDF文档                         │
│   ☑ 文件夹结构                       │
│ 输出目录: [outputs/gallery] [浏览...]│
├─────────────────────────────────────┤
│           [开始处理]                 │
├─────────────────────────────────────┤
│ 处理结果                             │
│ [结果显示区域]                       │
│ [打开输出文件夹]                     │
└─────────────────────────────────────┘
```

### 组件说明

1. **文件夹选择器**
   - 选择包含图片的源文件夹
   - 自动递归扫描子文件夹
   - 显示选中的路径

2. **参数配置区**
   - **聚类数量**: 控制分类的类别数
   - **输出格式**: 选择需要的输出格式
   - **输出目录**: 指定作品集保存位置

3. **开始处理按钮**
   - 启动处理流程
   - 处理中会显示进度对话框

4. **结果预览区**
   - 显示处理统计信息
   - 列出识别的类别
   - 提供快速访问按钮

---

## 功能详解

### 1. 图片识别

程序使用 CLIP 模型识别：
- **场景类型**: 海、山、城市、废墟等
- **拍摄主题**: 人物、建筑、自然、静物等
- **艺术风格**: 抽象、写实、人文等

### 2. 智能分类

**自动模式**（推荐）
- 程序自动确定最佳类别数
- 使用 Elbow 方法或轮廓系数

**手动模式**
- 自己指定类别数量
- 建议范围: 3-15

**分类效果**
- 相似场景的图片归为一类
- 具有共同主题的图片归为一类
- 风格相近的图片归为一类

### 3. 作品集生成

#### HTML 网页
- 📱 响应式设计，支持手机查看
- 🎨 精美的网格布局
- 🔗 类别导航栏
- 🖼️ 图片懒加载

#### PDF 文档
- 📄 专业排版
- 📊 每类一页
- 🖼️ 保持图片宽高比
- 📝 类别标题和描述

#### 文件夹结构
- 📁 按类别创建子文件夹
- 📋 保留原始文件名
- 💾 自动复制图片

---

## 输出格式

### HTML 格式

**文件结构**:
```
outputs/gallery/
├── gallery.html        # 主页面
├── styles.css          # 样式表
└── images/             # 图片文件夹
    ├── cluster_0_img1.jpg
    ├── cluster_0_img2.jpg
    └── ...
```

**使用方法**:
- 直接用浏览器打开 `gallery.html`
- 可以部署到网站服务器
- 分享给他人查看

**特点**:
- 支持全屏查看
- 可以搜索和过滤
- 移动端友好

### PDF 格式

**文件**:
```
outputs/gallery/
└── gallery.pdf         # PDF文档
```

**使用方法**:
- 用任何 PDF 阅读器打开
- 可以打印
- 便于分享

**特点**:
- 专业排版
- 适合打印
- 跨平台兼容

### 文件夹格式

**文件结构**:
```
outputs/gallery/folders/
├── 海/
│   ├── beach1.jpg
│   ├── beach2.jpg
│   └── ...
├── 山/
│   ├── mountain1.jpg
│   └── ...
└── 城市/
    ├── city1.jpg
    └── ...
```

**使用方法**:
- 直接在文件管理器中浏览
- 便于后续编辑
- 可以导入其他软件

**特点**:
- 简单直观
- 易于管理
- 保留原始文件

---

## 高级用法

### 配置文件

编辑 `config.json` 进行高级配置：

```json
{
  "model": {
    "clip_model_name": "openai/clip-vit-base-patch32",
    "device": "auto",          // 设备: auto/cuda/cpu
    "batch_size": 32           // 批处理大小
  },
  "clustering": {
    "algorithm": "kmeans",     // 算法: kmeans/dbscan
    "n_clusters": "auto",      // 类别数: auto 或数字
    "auto_cluster_method": "elbow",  // 自动方法: elbow/silhouette
    "min_samples": 5           // DBSCAN 最小样本数
  },
  "output": {
    "default_output_dir": "outputs/gallery"
  },
  "supported_formats": [       // 支持的图片格式
    ".jpg", ".jpeg", ".png", ".webp", ".bmp", ".gif"
  ]
}
```

### 批量处理

处理多个文件夹：

1. 方法一：合并到一个文件夹
   ```bash
   mkdir all_images
   cp folder1/* all_images/
   cp folder2/* all_images/
   # 然后处理 all_images
   ```

2. 方法二：分别处理
   - 为每个文件夹指定不同的输出目录
   - 避免覆盖之前的结果

### 性能优化

**提高速度**:
- 使用 GPU（自动检测）
- 增大 `batch_size`（如果内存充足）
- 关闭不需要的输出格式

**降低内存占用**:
- 减小 `batch_size`
- 分批处理图片
- 关闭其他程序

**提高准确性**:
- 使用更大的 CLIP 模型
- 增加聚类数量
- 手动调整类别数

---

## 最佳实践

### 📸 图片准备

1. **整理图片**
   - 删除重复图片
   - 移除损坏文件
   - 统一命名规范

2. **文件夹结构**
   ```
   my_photos/
   ├── trip1/
   ├── trip2/
   └── events/
   ```
   - 不需要预先分类
   - 程序会自动识别

### 🎯 参数选择

1. **聚类数量**
   - 图片少（<50）: 3-5 类
   - 图片中等（50-500）: 5-10 类
   - 图片多（>500）: 10-20 类

2. **输出格式**
   - 仅浏览: HTML
   - 需要打印: PDF
   - 后续编辑: 文件夹

### 💡 使用技巧

1. **首次使用**
   - 先用小数据集测试（10-20 张）
   - 熟悉界面和流程
   - 了解输出效果

2. **大量图片**
   - 分批处理（建议每批不超过 1000 张）
   - 确保足够的磁盘空间
   - 监控内存使用

3. **效果不满意**
   - 调整聚类数量
   - 尝试不同算法（KMeans/DBSCAN）
   - 检查图片质量

### ⚠️ 注意事项

1. **首次运行**
   - 需要下载模型（400MB）
   - 确保网络连接稳定
   - 可能需要 5-10 分钟

2. **处理时间**
   - 取决于图片数量和电脑性能
   - GPU 比 CPU 快 5-10 倍
   - 100 张图片约需 2-5 分钟

3. **输出文件**
   - 检查磁盘空间（约为原图片 2-3 倍）
   - 定期清理旧的输出
   - 备份重要的作品集

---

## 快捷操作

| 操作 | 快捷键/方法 |
|------|------------|
| 选择文件夹 | `Ctrl+O` |
| 开始处理 | `Enter` |
| 取消处理 | 进度窗口中的"取消"按钮 |
| 打开输出 | 结果区域的按钮 |

---

## 故障排除

### 程序无响应

1. 检查是否在处理中（查看进度窗口）
2. 等待处理完成
3. 如果确实卡住，重启程序

### 分类效果不理想

1. 增加或减少聚类数量
2. 尝试不同的聚类算法
3. 检查图片是否足够多样化

### 输出文件无法打开

1. 确认文件生成完整
2. 使用正确的程序打开
3. 检查文件路径中是否有特殊字符

---

## 获取帮助

如有其他问题，请：
- 查看 [常见问题](../README.md#常见问题)
- 查看 [安装指南](INSTALLATION.md)
- 提交 [Issue](https://github.com/yourusername/gallery-generate-agent/issues)

